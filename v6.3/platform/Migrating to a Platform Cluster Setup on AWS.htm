<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="concept _Skins_HTML5___Side_Navigation_2021" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Advanced setup and administration|Installing and administering Private Cloud|Multi-server environments">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Expires" content="0" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="192x192" href="../Skins/Favicons/IB_favicon_192x192.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/IB_favicon_96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/IB_favicon_32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/IB_favicon_16x16.png" /><title>Migrating to a Platform Cluster Setup on AWS </title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script>/* <![CDATA[ */
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'UA-164223934-1');
	/* ]]> */</script>
        <!-- Version dropdown -->
        <script type="text/javascript">/* <![CDATA[ */
			function gotopage(selval){
			var value = selval.options[selval.selectedIndex].value;
			window.location.href=value;
			}
		/* ]]> */</script>
        <link href="../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/ib_platform.css" rel="stylesheet" />
        <script src="../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../Resources/Scripts/require.min.js" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.config.js" defer="defer">
        </script>
        <script src="../Resources/Scripts/foundation.6.2.3_custom.js" defer="defer">
        </script>
        <script src="../Resources/Scripts/plugins.min.js" defer="defer">
        </script>
        <script src="../Resources/Scripts/MadCapAll.js" defer="defer">
        </script>
        <script src="../Resources/Scripts/jira_issue_collector.js">
        </script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-164223934-1">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-left" role="navigation" id="offCanvas" data-off-canvas="" data-position="left" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-device-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../Welcome.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search our documentation..." />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <main id="main" class="body-container">
                                <div data-mc-content-body="True">
                                    <div style=" text-align: right; border-radius: 4px; color:white; font-size: 9pt; background: linear-gradient(0deg, rgba(35,129,195,1) 35%, rgba(2,54,96,1) 100%); margin-bottom: 15px; padding: 4px 12px; ">Documentation Version 
		<select class="minimal" onchange="gotopage(this)"><option value="">6.3 (current)</option><option value="https://documentation.infiniteblue.com/6.2/platform/What's%20New%20in%20Platform%206.2.htm" target="_blank">6.2</option><option value="https://documentation.infiniteblue.com/6.4/platform/What's%20New%20in%20Platform%206.4.htm" target="_blank">6.4</option><option value="https://documentation.infiniteblue.com/6.5/platform/What's%20New%20in%20Platform%206.5.htm" target="_blank">6.5</option><option value="https://documentation.infiniteblue.com/platform/What's%20New%20in%20Platform%206.6.htm" target="_blank">6.6</option></select></div>
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <div class="home-container">
                                        <h1 class="concepttitle">Migrating to a Platform Cluster Setup on AWS </h1>
                                        <p><b>Before you begin: </b> Ensure for the following:</p>
                                        <p>
                                            <ol>
                                                <li value="1">You must have access to IAM (administrator) user for your
					account.</li>
                                                <li value="2">The existing VPC meets the following criteria:<p><ul><li value="1">Two AZs</li><li value="2">Two Public Subnets</li><li value="3">Two Private Subnets</li><li value="4">Two NAT Gateways</li></ul></p></li>
                                                <li value="3">Take the RDS snapshot before starting with the migration
					steps.</li>
                                            </ol>
                                            <div class="note"><b>Note: </b>Until the step# 4 of the <b>Migrating to a Platform Cluster</b> to a
				Platform Cluster section of this guide, you can have your existing environment up
				and running.</div>
                                        </p>
                                        <div class="section">
                                            <h2 class="sectiontitle">Getting Started with the Migration Process</h2>
                                            <p>
                                                <ol>
                                                    <li value="1">Download aws.zip from Platform site and copy it to a Controller server (from
						where all deployment scripts would be initiated)</li>
                                                    <li value="2">Unzip the folder to view the following structure.<p><pre>--- &lt;aws&gt;
|-- build (Holds scripts and data-files related to building of AMI)
|-- Cluster-config (Contains tools to run UI tool to generate your input files)
|-- deploy  (Top folder bundling all Ansible deploy scripts/playbooks)
	|--  scripts
	|-- playbooks
	|-- inventory
	|-- config_files (Configuration files used as part of deployment process)
	|-- scripts (Scripts that are executed as part of Cluster launch )
	|-- ansible_templates ( CFN templates used for deployment)
	|-- output      ( Created at runtime – used to store output files of each playbook )
	|-- migration (Created by user while copying config folder from existing server )
</pre></p></li>
                                                    <li value="3">To create a new AMI for your deployment see <a href="Deploying Platform on AWS.htm">Deploying Platform on
							AWS</a>. </li>
                                                    <li value="4">Move to the <span class="filepath">deploy</span> folder.</li>
                                                    <li value="5">From your existing Platform master, copy the <span class="filepath">config</span> file contents to the <span class="filepath">migration</span> sub folder.</li>
                                                    <li value="6">Ensure that <code>AWS_SECRET_KEY</code> and <code>AWS_ACCESS_KEY</code> variables are sourced in your
						current shell.</li>
                                                    <li value="7">Set <code>JAVA_HOME</code> variable point to Java1.8 on
						your controller machine and also include <code>$JAVA_HOME/bin</code> in your <code>PATH</code>
						variable.</li>
                                                    <li value="8">Login to your account and get values for the current VPC properties listed
							below.<ul><li value="1">VPC ID</li><li value="2">PublicSubnet1</li><li value="3">PublicSubnet2</li><li value="4">PrivateSubnet1</li><li value="5">PrivateSubnet2</li><li value="6">AZ1</li><li value="7">AZ2</li></ul></li>
                                                    <li value="9">Run the <span class="uicontrol">Config-UI</span> tool to generate
						the <span class="filepath">app-config</span> and <span class="filepath">topology.json</span>, ensuring that at least the
						same number of Storage/Search servers that are in the current environment
						are retained. </li>
                                                    <li value="10">Edit the <span class="filepath">app.config</span> file and add the below properties
						with the values.<p><ul><li value="1">RDS_DB_END_POINT:
									rlb-rds-cust-int-dbo.cobn7nddxtef.us-east-1.rds.amazonaws.com</li><li value="2">VPC: vpc-29e2844e</li><li value="3">vpcAZ1: us-east-1c</li><li value="4">vpcAZ2: us-east-1d</li><li value="5">vpcPubSubnet1: subnet-e6172dcc</li><li value="6">vpcPubSubnet2: subnet-b8da30f1</li><li value="7">vpcPvtSubnet1: subnet-e7172dcd</li><li value="8">vpcPvtSubnet2: subnet-bbda30f2</li></ul></p></li>
                                                </ol>
                                            </p>
                                        </div>
                                        <div class="section">
                                            <h2 class="sectiontitle">Migrating to a Platform Cluster Setup</h2>
                                            <p>
                                                <ol>
                                                    <li value="1">Run the <code>init.yml </code> script. This playbook would setup
						necessary files like encryption key file.<p><code>ansible-playbook -i ../inventory/host
								init.yml</code></p></li>
                                                    <li value="2">Run <code>update-vpc.yml</code><p><code>ansible-playbook -i ../inventory/host
								update-vpc.yml</code></p><p>This would re-use
							existing Public/Private Subnets and VPC that were provided as part of
							the input and create the following resources:<ul><li value="1">IAM Roles</li><li value="2">SQS-SNS</li><li value="3">EFS Volumes</li><li value="4">Security Groups</li><li value="5">S3 Buckets for storing configuration files</li><li value="6">Upload all required configuration files to
									S3</li></ul></p></li>
                                                    <li value="3">Run <code>create-asg.yml</code><p><code>ansible-playbook -i ../inventory/host
								create-asg.yml</code></p><p>This playbook would
							create AutoScaling groups for Nginx/OPS and for each of the Role that is
							defined in your <span class="filepath">topology.json</span></p><p>All of the AutoScaling Groups would include:<ul><li value="1">Launch Configurations with userdata</li><li value="2">LifeCycle hooks</li><li value="3">Notification hooks with SNS sending messages to
									SQS queue</li></ul></p></li>
                                                    <li value="4">Run <code>create.hooks.yml</code><p><code>ansible-playbook -i ../inventory/host
								create-hooks.yml</code></p><p>This playbook
							creates LifeCycle hooks that would be attached to the corresponding
							AutoScaling group.</p><p><div class="note"><b>Note: </b>Ensure that at this point, your current
								application servers are completely shutdown and there are no
								existing connections to the RDS. </div></p></li>
                                                    <li value="5">Run <code>launch-migrate-node.yml</code><p><code>ansible-playbook -i ../inventory/host
								launch-migrate-node.yml</code></p><p>To complete
							the migration, copy the existing Storage/Search data to the new cluster.
							This playbook when executed, will launch an OPS node having /efs_data
							(EFS volume) mounted.</p><p>Also, the instance would
							have all ports open for the Private IP range (within VPC), which means
							that you would be able to connect to this instance over scp from your
							existing Search/Storage machine which is in the same VPC. If the storage
							is not huge, then do a ‘simple’ scp from the old (existing)
							Storage/Search machine and copy over the contents to the new machine
							(recommended to zip, copy and then unzip)</p><p> For
							example: <code>scp -r -i /tmp/my-keypair Files
								ec2-user@10.230.13.23:/efs_data/storage1</code></p><p>However if the data is huge, then consider migrating
							the data ahead of time than actual application migration date. </p><p><div class="note"><b>Note: </b><p>Storage data needs to be copied to <span class="filepath">
										/efs_data/&lt;storage_component_name&gt;/</span> and
									Search data to be copied to <span class="filepath">/efs_data/&lt;search_component_name&gt;</span>.</p><p>So, if in your topology, there are more than 1
									Storage/Search components, copy the data folders for each
									component to its respective folder under <span class="filepath">/efs_data</span> .</p></div></p></li>
                                                    <li value="6">Ensure that the RDS is using DBSG created by this process and also
						update_5.0.0.0.sql has been executed against all RDS used by your
						environment.</li>
                                                    <li value="7">Launch the new cluster with the command <code>ansible-playbook -i
							../inventory/host launch-cluster.yml</code><p>This playbook updates the ASG parameters –
							Min/Max/Desired number of instances to match the values set in your
								<span class="filepath">topology.json</span> and waits until
							the application endpoint is reachable. At the end of this command
							execution, your environment becomes accessible.</p></li>
                                                </ol>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="home-footer">
                                        <p class="footer" style="color: #4d4d4d; text-align: right; vertical-align: middle;">© 2022 <a style="color: #4d4d4d;" href="http://www.infiniteblue.com/">Infinite Blue Platform</a>. All rights reserved.</p>
                                    </div>
                                </div>
                            </main>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>